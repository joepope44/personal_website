<!DOCTYPE html>
<html lang='en'><head>
  <title>Coffee Ratings - Joseph Pope</title>
  <link rel='canonical' href='/post/coffee-ratings/' />
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <meta name='description' content='TidyTuesday project modelling coffee ratings' />
  <meta name='theme-color' content='#FD3519' />
  
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
  

  <meta name="generator" content="Hugo 0.72.0" />

  





<link rel="stylesheet" href="/sass/style.min.cf2eeff825d4dbc673ce0b82d270d9fc32d34973a7d5cd079e0dcf4fe3e77515.css" integrity="sha256-zy7v&#43;CXU28ZzzguC0nDZ/DLTSXOn1c0Hng3PT&#43;PndRU=" media="screen">
<link rel="stylesheet" href="/syntax.min.css" integrity="" media="screen">

  <meta property="og:title" content="Coffee Ratings" />
<meta property="og:description" content="TidyTuesday project modelling coffee ratings" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/coffee-ratings/" />
<meta property="article:published_time" content="2020-07-07T08:23:44-04:00" />
<meta property="article:modified_time" content="2020-07-07T00:00:00+00:00" />

  <meta itemprop="name" content="Coffee Ratings">
<meta itemprop="description" content="TidyTuesday project modelling coffee ratings">
<meta itemprop="datePublished" content="2020-07-07T08:23:44-04:00" />
<meta itemprop="dateModified" content="2020-07-07T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="3938">



<meta itemprop="keywords" content="" />
</head>
<body>

  <header style="background-image:linear-gradient(
      rgba(0,0,0,0.4),rgba(0,0,0,0.4)
    ),url(&#39;/images/1-min.jpg&#39;)">

  <div class="intro">
    <div class="logo-container">
      <a href="/">
        <img src='/images/joe.jpg' alt="Profile HOME" class="rounded-logo">
      </a>
    </div>
    <h2>Joseph Pope</h2>
    <h3>Data Analysis | Data Viz</h3>
    <div class="menu">
      

        <p>
            <a href="/about/">
                About
            </a>
        </p>

        <p>
            <a href="/portfolio/">
                Portfolio
            </a>
        </p>

        <p>
            <a href="/post/">
                Post
            </a>
        </p>

        <p>
            <a href="https://www.cnn.com">
                Link
            </a>
        </p>

      
        
        <p>
            <a href="mailto:joepope44@gmail.com" target="_blank" rel="external">
                Contact
            </a>
        </p>
      
    </div>

  </div>

  <div class="socials">
      
  
    <a href="https://github.com/joepope44" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM71.182 98.494c-2.156.385-2.952-.95-2.952-2.053 0-1.386.051-8.471.051-14.195 0-4.005-1.335-6.546-2.9-7.881C74.878 73.313 84.89 72.003 84.89 55.6c0-4.671-1.669-7.007-4.39-10.01.436-1.105 1.9-5.648-.436-11.552-3.568-1.104-11.731 4.595-11.731 4.595-3.389-.95-7.06-1.438-10.679-1.438-3.62 0-7.29.488-10.679 1.438 0 0-8.163-5.699-11.73-4.595-2.337 5.878-.899 10.422-.437 11.551-2.72 3.004-4.004 5.34-4.004 10.011 0 16.326 9.574 17.712 19.072 18.765-1.232 1.104-2.336 3.003-2.72 5.724-2.44 1.104-8.677 3.004-12.4-3.568-2.335-4.056-6.545-4.39-6.545-4.39-4.159-.05-.282 2.619-.282 2.619 2.772 1.283 4.723 6.212 4.723 6.212 2.49 7.624 14.4 5.057 14.4 5.057 0 3.568.052 9.37.052 10.422 0 1.104-.77 2.438-2.952 2.053C27.21 92.821 15.35 76.701 15.35 57.86c0-23.564 18.02-41.456 41.585-41.456s42.663 17.892 42.663 41.456c.026 18.842-11.474 34.988-28.416 40.635zM46 82.81c-.488.103-.95-.102-1.001-.436-.051-.385.282-.719.77-.822.488-.05.95.154 1.001.488.077.334-.257.668-.77.77zm-2.439-.23c0 .333-.385.615-.898.615-.565.052-.95-.23-.95-.616 0-.333.385-.616.899-.616.487-.051.95.231.95.616zm-3.516-.283c-.103.334-.616.488-1.053.334-.488-.103-.821-.488-.719-.822.103-.334.617-.488 1.053-.385.513.154.847.54.719.873zm-3.158-1.386c-.23.282-.718.23-1.104-.154-.385-.334-.487-.822-.23-1.053.23-.282.718-.23 1.103.154.334.334.462.847.231 1.053zm-2.336-2.336c-.23.154-.667 0-.95-.385-.282-.385-.282-.822 0-1.001.283-.231.72-.052.95.333.283.385.283.847 0 1.053zm-1.668-2.49c-.231.23-.616.103-.899-.154-.282-.334-.333-.719-.102-.899.23-.23.616-.102.898.154.282.334.334.72.103.899zm-1.72-1.9c-.103.231-.436.283-.719.103-.334-.154-.488-.436-.385-.667.103-.154.385-.231.719-.103.334.18.488.462.385.667z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://www.linkedin.com/in/josephwpope" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M106.786 0H8.189C3.67 0 0 3.722 0 8.291v98.418C0 111.278 3.67 115 8.189 115h98.597c4.518 0 8.214-3.722 8.214-8.291V8.29C115 3.722 111.304 0 106.786 0zm-72.03 98.571H17.713V43.69h17.07V98.57h-.025zm-8.522-62.377c-5.467 0-9.882-4.44-9.882-9.883 0-5.442 4.415-9.882 9.882-9.882 5.442 0 9.883 4.44 9.883 9.882a9.87 9.87 0 0 1-9.883 9.883zm72.414 62.377H81.604V71.875c0-6.366-.129-14.555-8.856-14.555-8.882 0-10.242 6.931-10.242 14.093V98.57H45.46V43.69h16.352v7.495h.23c2.285-4.312 7.855-8.856 16.147-8.856 17.25 0 20.458 11.372 20.458 26.158V98.57z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://medium.com/@joepope44" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M0 0v115h115V0H0zm95.542 27.235l-6.16 5.905a1.81 1.81 0 0 0-.693 1.72v43.458c-.103.667.154 1.335.693 1.72l6.032 5.904v1.31h-30.29v-1.259l6.238-6.058c.616-.616.616-.795.616-1.72V43.074L54.625 87.123h-2.336l-20.202-44.05v29.52c-.18 1.233.257 2.49 1.13 3.39l8.111 9.83v1.31H18.277v-1.31l8.111-9.83a3.93 3.93 0 0 0 1.053-3.39v-34.14a2.93 2.93 0 0 0-.976-2.516l-7.213-8.702v-1.309h22.41l17.301 37.991 15.222-37.965h21.357v1.283z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://twitter.com/joepope44" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM90.126 40.763c.051.72.051 1.464.051 2.182 0 22.256-16.942 47.9-47.9 47.9-9.548 0-18.404-2.772-25.848-7.547 1.36.154 2.67.205 4.055.205 7.881 0 15.12-2.67 20.895-7.187-7.392-.154-13.604-5.006-15.735-11.68 2.593.385 4.929.385 7.598-.308a16.837 16.837 0 0 1-13.476-16.531v-.205a16.824 16.824 0 0 0 7.598 2.13 16.8 16.8 0 0 1-7.496-14.016c0-3.131.822-6.006 2.285-8.496a47.803 47.803 0 0 0 34.705 17.61c-2.387-11.424 6.161-20.69 16.429-20.69 4.851 0 9.215 2.027 12.296 5.313a32.99 32.99 0 0 0 10.678-4.056 16.792 16.792 0 0 1-7.393 9.267c3.389-.36 6.674-1.31 9.703-2.618a35.437 35.437 0 0 1-8.445 8.727z"/>
  
  </svg>
</div>
</a>
  

  </div>

</header>

  <div class="content-wrapper">
    
      <div class="breadcrumb">
  





<span >
  <a href="/">HOME</a>
   / 
</span>


<span >
  <a href="/post/">POST</a>
   / 
</span>


<span  class="active">
  <a href="/post/coffee-ratings/">Coffee Ratings</a>
  
</span>

</div>

    
    <main id="content" class="post">

<h1>Coffee Ratings</h1>
<div class="reading-time">
  <div class="icon">
  <svg width="18px" height="18px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M57.5 11C29.05 11 6 34.05 6 62.5S29.05 114 57.5 114 109 90.95 109 62.5 85.95 11 57.5 11zm0 93.032c-22.947 0-41.532-18.585-41.532-41.532 0-22.947 18.585-41.532 41.532-41.532 22.947 0 41.532 18.585 41.532 41.532 0 22.947-18.585 41.532-41.532 41.532zm12.833-21.68L52.703 69.54a2.508 2.508 0 0 1-1.018-2.015V33.427a2.5 2.5 0 0 1 2.492-2.492h6.646a2.5 2.5 0 0 1 2.492 2.492v29.426l13.871 10.092c1.122.81 1.35 2.368.54 3.49l-3.904 5.377a2.51 2.51 0 0 1-3.489.54z"/>
  
  </svg>
</div>

  <span>19 minutes</span>
</div>

<div class="published-date">
  <div class="icon">
  <svg width="18px" height="18px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M77.577 51.23a1.807 1.807 0 0 0-2.2.342l-27.562 27.79a1.807 1.807 0 0 1-2.2.342l-14.008-9.702a1.807 1.807 0 0 0-2.2.342l-1.952 1.968c-.287.22-.456.568-.455.936.001.37.172.716.46.934L45.637 86.77a1.807 1.807 0 0 0 2.2-.342l31.709-31.97c.287-.22.456-.567.455-.936a1.175 1.175 0 0 0-.46-.933l-1.963-1.36z"/><path d="M97.304 20H80.512c-.041.34-.063.683-.064 1.026a5.986 5.986 0 0 0 1.256 4.1c.054.003.103.02.157.025a4.881 4.881 0 0 1 1.865-.025c3.05.562 4.984 3.907 4.32 7.47-.666 3.563-3.678 5.996-6.728 5.433a4.932 4.932 0 0 1-2.437-1.258c-6.018-1.378-10.445-7.795-10.445-15.745 0-.347.023-.685.04-1.026H34.579c-.041.34-.063.683-.064 1.026a5.986 5.986 0 0 0 1.256 4.1c.054.003.103.02.157.025a4.881 4.881 0 0 1 1.865-.025c3.05.562 4.984 3.907 4.32 7.47-.666 3.563-3.678 5.996-6.728 5.433a4.932 4.932 0 0 1-2.437-1.258c-6.018-1.378-10.445-7.795-10.445-15.745 0-.22.019-.434.025-.652a9.788 9.788 0 0 0-5.697 4.471 9.683 9.683 0 0 0-2.65 4.764L1.158 92.871c-.965 4.689 2.6 8.503 7.948 8.503h6.334v2.673c-.077 5.41 4.263 9.861 9.705 9.953h72.16c5.438-.095 9.774-4.546 9.694-9.953V29.953c.08-5.407-4.256-9.858-9.695-9.953zM10.078 96.653c-2.378 0-3.964-1.697-3.535-3.782L16.637 43.84h80.787L87.331 92.871a5.254 5.254 0 0 1-5.091 3.782H10.078zm91.535 7.394c.036 2.403-1.891 4.382-4.308 4.424h-72.16c-2.42-.04-4.352-2.018-4.32-4.424v-2.673h60.443c5.348 0 10.484-3.814 11.449-8.503l8.897-43.215v54.391z"/><path d="M34.814 33c1.243 0 2.251-1.057 2.251-2.36 0-1.305-1.008-2.362-2.25-2.362-2.04 0-4.313-3.194-4.313-7.778s2.272-7.778 4.312-7.778c1.227 0 2.536 1.163 3.386 3.084H43C41.716 11.19 38.578 8 34.814 8 29.871 8 26 13.49 26 20.5c0 7.009 3.871 12.5 8.814 12.5z"/>
  
  </svg>
</div>

  <span>July 7, 2020</span>
</div>

</p>
<div id="intro" class="section level1">
<h1>Intro</h1>
<p>Today I am going to explore Coffee Ratings for this week’s Tidy Tuesday challenge. The data comes from the <a href="https://github.com/jldbc/coffee-quality-database">Coffee Quality Database</a>. The great thing about Tidy Tuesday is that we can do whatever we want with the data. There are no rules or directions!</p>
<p>This data is very interesting with many features and looks ripe for a predictive model. I can use the various ratings provided to predict either a quantitative method, like what the ‘total_cup_score’ (Overall rating) is, or a qualitative measure, like what species of bean (Arabica or Robusta) or perhaps the country of origin.</p>
<p>Predicting scores strikes me as a classic regression problem, best tackled by linear models or random forests, and classification could be solved with logistic regression, Naive Bayes, SVM or even neural networks. I’ve NEVER used <code>tidymodels</code> before, so let’s give it a go, make some mistakes, and see what we can learn.</p>
<p>But first, some brief background of our data from the TidyTuesday repo:</p>
<blockquote>
<p>There is data for both Arabica and Robusta beans, across many countries and professionally rated on a 0-100 scale. All sorts of scoring/ratings for things like acidity, sweetness, fragrance, balance, etc - may be useful for either separating into visualizations/categories or for modeling/recommenders.</p>
</blockquote>
<blockquote>
<p>Wikipedia on Coffee Beans:</p>
</blockquote>
<blockquote>
<p>The two most economically important varieties of coffee plant are the Arabica and the Robusta; ~60% of the coffee produced worldwide is Arabica and ~40% is Robusta. Arabica beans consist of 0.8–1.4% caffeine and Robusta beans consist of 1.7–4% caffeine.</p>
</blockquote>
<p>Setup</p>
<pre class="r"><code>library(tidytuesdayR)
library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ───────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.2     ✓ purrr   0.3.4
## ✓ tibble  3.0.1     ✓ dplyr   1.0.0
## ✓ tidyr   1.1.0     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ──────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(tidymodels)</code></pre>
<pre><code>## ── Attaching packages ──────────── tidymodels 0.1.0 ──</code></pre>
<pre><code>## ✓ broom     0.5.6      ✓ rsample   0.0.6 
## ✓ dials     0.0.6      ✓ tune      0.1.0 
## ✓ infer     0.5.1      ✓ workflows 0.1.1 
## ✓ parsnip   0.1.1      ✓ yardstick 0.0.6 
## ✓ recipes   0.1.12</code></pre>
<pre><code>## ── Conflicts ─────────────── tidymodels_conflicts() ──
## x scales::discard() masks purrr::discard()
## x dplyr::filter()   masks stats::filter()
## x recipes::fixed()  masks stringr::fixed()
## x dplyr::lag()      masks stats::lag()
## x dials::margin()   masks ggplot2::margin()
## x yardstick::spec() masks readr::spec()
## x recipes::step()   masks stats::step()</code></pre>
<pre class="r"><code>library(knitr)
library(kableExtra)</code></pre>
<pre><code>## 
## Attaching package: &#39;kableExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     group_rows</code></pre>
<pre class="r"><code>knitr::opts_chunk$set(
    fig.height = 5,
    fig.width = 8,
    message = FALSE,
    warning = FALSE,
    dpi = 180,
    include = TRUE
)</code></pre>
<p>Load the data</p>
<pre class="r"><code>tuesdata &lt;- tidytuesdayR::tt_load(2020, week = 28)
coffee_ratings &lt;- tuesdata$coffee_ratings</code></pre>
</div>
<div id="eda" class="section level1">
<h1>EDA</h1>
<p>Now that we have our data and let’s dive in. Let’s review the summary statistics with skimr.</p>
<pre class="r"><code>coffee_ratings %&gt;% 
  skimr::skim()</code></pre>
<table style='width: auto;'
        class='table table-condensed'>
<caption>
<span id="tab:skim">Table 1: </span>Data summary
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
Piped data
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1339
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
43
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
24
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
19
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
empty
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:right;">
whitespace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
species
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
owner
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
315
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
country_of_origin
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
farm_name
</td>
<td style="text-align:right;">
359
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
73
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
571
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_number
</td>
<td style="text-align:right;">
1063
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
227
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
mill
</td>
<td style="text-align:right;">
315
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
77
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
460
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
ico_number
</td>
<td style="text-align:right;">
151
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
847
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
company
</td>
<td style="text-align:right;">
209
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
73
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
281
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
altitude
</td>
<td style="text-align:right;">
226
</td>
<td style="text-align:right;">
0.83
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
396
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
region
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
356
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
producer
</td>
<td style="text-align:right;">
231
</td>
<td style="text-align:right;">
0.83
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
691
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
bag_weight
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
in_country_partner
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
harvest_year
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
46
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
grading_date
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
567
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
owner_1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
319
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
variety
</td>
<td style="text-align:right;">
226
</td>
<td style="text-align:right;">
0.83
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
processing_method
</td>
<td style="text-align:right;">
170
</td>
<td style="text-align:right;">
0.87
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
color
</td>
<td style="text-align:right;">
218
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
expiration
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
566
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
certification_body
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
certification_address
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
certification_contact
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
unit_of_measurement
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
total_cup_points
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
82.09
</td>
<td style="text-align:right;">
3.50
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
81.08
</td>
<td style="text-align:right;">
82.50
</td>
<td style="text-align:right;">
83.67
</td>
<td style="text-align:right;">
90.58
</td>
<td style="text-align:left;">
▁▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
number_of_bags
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
154.18
</td>
<td style="text-align:right;">
129.99
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
14.00
</td>
<td style="text-align:right;">
175.00
</td>
<td style="text-align:right;">
275.00
</td>
<td style="text-align:right;">
1062.00
</td>
<td style="text-align:left;">
▇▇▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
aroma
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7.57
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7.42
</td>
<td style="text-align:right;">
7.58
</td>
<td style="text-align:right;">
7.75
</td>
<td style="text-align:right;">
8.75
</td>
<td style="text-align:left;">
▁▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
flavor
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7.52
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7.33
</td>
<td style="text-align:right;">
7.58
</td>
<td style="text-align:right;">
7.75
</td>
<td style="text-align:right;">
8.83
</td>
<td style="text-align:left;">
▁▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
aftertaste
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7.40
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7.25
</td>
<td style="text-align:right;">
7.42
</td>
<td style="text-align:right;">
7.58
</td>
<td style="text-align:right;">
8.67
</td>
<td style="text-align:left;">
▁▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
acidity
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7.54
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7.33
</td>
<td style="text-align:right;">
7.58
</td>
<td style="text-align:right;">
7.75
</td>
<td style="text-align:right;">
8.75
</td>
<td style="text-align:left;">
▁▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
body
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7.52
</td>
<td style="text-align:right;">
0.37
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7.33
</td>
<td style="text-align:right;">
7.50
</td>
<td style="text-align:right;">
7.67
</td>
<td style="text-align:right;">
8.58
</td>
<td style="text-align:left;">
▁▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
balance
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7.52
</td>
<td style="text-align:right;">
0.41
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7.33
</td>
<td style="text-align:right;">
7.50
</td>
<td style="text-align:right;">
7.75
</td>
<td style="text-align:right;">
8.75
</td>
<td style="text-align:left;">
▁▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
uniformity
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
9.83
</td>
<td style="text-align:right;">
0.55
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:left;">
▁▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
clean_cup
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
9.84
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:left;">
▁▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
sweetness
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
9.86
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:left;">
▁▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
cupper_points
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
7.50
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7.25
</td>
<td style="text-align:right;">
7.50
</td>
<td style="text-align:right;">
7.75
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:left;">
▁▁▁▇▁
</td>
</tr>
<tr>
<td style="text-align:left;">
moisture
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:left;">
▃▇▅▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
category_one_defects
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.48
</td>
<td style="text-align:right;">
2.55
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
63.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
quakers
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.83
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
11.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
category_two_defects
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
3.56
</td>
<td style="text-align:right;">
5.31
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
4.00
</td>
<td style="text-align:right;">
55.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
altitude_low_meters
</td>
<td style="text-align:right;">
230
</td>
<td style="text-align:right;">
0.83
</td>
<td style="text-align:right;">
1750.71
</td>
<td style="text-align:right;">
8669.44
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1100.00
</td>
<td style="text-align:right;">
1310.64
</td>
<td style="text-align:right;">
1600.00
</td>
<td style="text-align:right;">
190164.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
altitude_high_meters
</td>
<td style="text-align:right;">
230
</td>
<td style="text-align:right;">
0.83
</td>
<td style="text-align:right;">
1799.35
</td>
<td style="text-align:right;">
8668.81
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1100.00
</td>
<td style="text-align:right;">
1350.00
</td>
<td style="text-align:right;">
1650.00
</td>
<td style="text-align:right;">
190164.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
altitude_mean_meters
</td>
<td style="text-align:right;">
230
</td>
<td style="text-align:right;">
0.83
</td>
<td style="text-align:right;">
1775.03
</td>
<td style="text-align:right;">
8668.63
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1100.00
</td>
<td style="text-align:right;">
1310.64
</td>
<td style="text-align:right;">
1600.00
</td>
<td style="text-align:right;">
190164.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
</tbody>
</table>
</div>
<div id="check-initial-assumptions" class="section level1">
<h1>Check Initial Assumptions</h1>
<p>I originally wanted to predict “total_cup_points”. However, after some review it appears that this field is simply the sum of ten other ratings, from aroma to cupper_points. What I really want to predict is Cupper Points. This is the reviewer’s (aka the Cupper’s) personal overall rating for the cup of joe. I can use this as dependant variable in a regression analysis. This should help me identify which features (aroma, acidity, elevation, country of origin?) influence the final rating the most.</p>
</div>
<div id="potential-features" class="section level1">
<h1>Potential Features</h1>
<p>Before we dig further into the data, let’s speculate what might factors go into a superior coffee bean. If coffee is like wine, then perhaps region (lat, long, altitude, preciptation, average hours of sunlight, etc) makes a big difference. Perhaps certain companies utilize best practices and farming techniques. Maybe certain processing methods are better than others. We are given the testing date and the expiration date, so we can add a feature that measures how fresh the beans are. These features and more could be really important or totally useless. I have no idea! Let’s see what the data has to say about it.</p>
<p>The wiki in the readme suggests that coffee beans are split 60/40 worldwide, by Arabica and Robusta. However, for this analysis the split is much more imbalanced. I thought it would be very interesting to build an Arabica vs. Robusta classifier but with such an imbalanced set I don’t think upsampling or other methods will be enough to build a robust model.</p>
<pre class="r"><code>table(coffee_ratings$species)</code></pre>
<pre><code>## 
## Arabica Robusta 
##    1311      28</code></pre>
<p>Let’s take a peak at the distribution of country of origin field. It is mentioned in the articles that Ethiopia wins top prize, however most of the coffees are from Central and South America.</p>
<pre class="r"><code>coffee_ratings %&gt;% 
  group_by(country_of_origin) %&gt;% 
  tally() %&gt;% 
  top_n(., 10) %&gt;% 
  arrange(desc(n))</code></pre>
<pre><code>## # A tibble: 10 x 2
##    country_of_origin                n
##    &lt;chr&gt;                        &lt;int&gt;
##  1 Mexico                         236
##  2 Colombia                       183
##  3 Guatemala                      181
##  4 Brazil                         132
##  5 Taiwan                          75
##  6 United States (Hawaii)          73
##  7 Honduras                        53
##  8 Costa Rica                      51
##  9 Ethiopia                        44
## 10 Tanzania, United Republic Of    40</code></pre>
<p>Let’s pull this list of top 10 countries into a list to reference later.</p>
<pre class="r"><code>top_countries &lt;- coffee_ratings %&gt;% 
  group_by(country_of_origin) %&gt;% 
  tally() %&gt;% 
  top_n(., 10) %&gt;% 
  arrange(desc(n)) %&gt;% 
  pull(country_of_origin)</code></pre>
<p>Out of curiousity, let’s see the count of coffee bean color. This was news to me, but apparently coffee beans are mostly blue or green in color when fresh. It is only after roasting that the color darkens to that familiar, uh, “coffee-brown” color. If you learn nothing else today, you can at least learn this.</p>
<div class="figure">
<img src="https://theroasterie.com/wp-content/uploads/download.jpg" alt="The Coffee Bean Spectrum" />
<p class="caption">The Coffee Bean Spectrum</p>
</div>
<pre class="r"><code>table(coffee_ratings$color)</code></pre>
<pre><code>## 
##   Blue-Green Bluish-Green        Green         None 
##           85          114          870           52</code></pre>
<p>Robusta is seen below with a higher modal peak, suggesting the species, known for its higher caffeine levels, is rated higher than Arabica. This could be due to a small sample size though.</p>
<pre class="r"><code>coffee_ratings %&gt;% 
  mutate(id = row_number()) %&gt;% 
  select(id, species, cupper_points) %&gt;% 
  ggplot(aes(cupper_points, fill = species)) +
  geom_density(alpha = 0.1)</code></pre>
<p><img src="//post/2020-07-07-coffee-ratings_files/figure-html/density%20plots-1.png" width="1440" /></p>
<pre class="r"><code>  # geom_histogram(position = &quot;identity&quot;, alpha = 0.7, show.legend = FALSE)</code></pre>
</div>
<div id="tidymodels" class="section level1">
<h1>TIDYMODELS</h1>
<p>I have never used tidymodels, so let’s see how this goes. Let’s try to tackle the regression model first. From the skim package, we know we have no missing values or junky data for this. Nice!</p>
<p>First thing to do is narrow our data and make it ripe for modeling. TidyTuesday mentions that Yorgos Askalidis already determined that altitude, processing_method and color have no bearing to the cupping score, and I think that makes sense. I will omit those features for now. That leaves us with species, country of origin and several ratings and measurements of the coffee samples. I am going to take the top ten countries only (out of 36 in the data) and lump the rest into “Other” with forcats. This is simply to speed up the processing without losing too much information gain for the feature.</p>
<blockquote>
<p>Note - I went back after trying the models a few times and removed ‘species’. In this smaller, filtered dataset there are only 3 records with Robusta coffee beans. It caused me some issues, and with only 3 members of the minority class, I decided to just remove it completely.</p>
</blockquote>
<pre class="r"><code>coffee &lt;- coffee_ratings %&gt;%
  mutate(id = row_number()) %&gt;% # add ID field, convert NA to Other
  select(id, country_of_origin, variety, aroma:moisture) %&gt;% # select features
  mutate(country_of_origin = case_when(
    country_of_origin %in% top_countries ~ country_of_origin,
    TRUE ~ &quot;Other&quot;
  )) %&gt;%
  mutate_if(is.character, as.factor) %&gt;% # convert country and variety to factors
  filter(cupper_points != 0) %&gt;% # remove 0 point scores as junk data
  drop_na() # drop NA for country and variety fields. only affects 200 records</code></pre>
<p>Split the data</p>
<blockquote>
<p>Note - I initially tried to stratify by species, even though there aren’t many Robusta coffee samples in the data. I ended up removing this due to the severe class imbalance. It may have been worth the effort to upsample Robusta and then stratify by species.</p>
</blockquote>
<pre class="r"><code>set.seed(1234)

coffee_split &lt;- coffee %&gt;% 
  initial_split()

coffee_train &lt;- training(coffee_split)
coffee_test &lt;- testing(coffee_split)</code></pre>
<p>Naive linear model with no scaling or pre-processing</p>
<pre class="r"><code>lm_spec &lt;- linear_reg() %&gt;%
  set_engine(engine = &quot;lm&quot;)

lm_spec</code></pre>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Computational engine: lm</code></pre>
<pre class="r"><code>## Linear Regression Model Specification (regression)
##
## Computational engine: lm
lm_fit &lt;- lm_spec %&gt;%
  fit(cupper_points ~ .,
    data = coffee_train
  )

lm_fit</code></pre>
<pre><code>## parsnip model object
## 
## Fit time:  10ms 
## 
## Call:
## stats::lm(formula = formula, data = data)
## 
## Coefficients:
##                                   (Intercept)  
##                                      2.501509  
##                                            id  
##                                     -0.000309  
##                     country_of_originColombia  
##                                     -0.099026  
##                   country_of_originCosta Rica  
##                                     -0.020488  
##                     country_of_originEthiopia  
##                                      0.029321  
##                    country_of_originGuatemala  
##                                     -0.045107  
##                     country_of_originHonduras  
##                                     -0.013921  
##                       country_of_originMexico  
##                                      0.030019  
##                        country_of_originOther  
##                                      0.003251  
##                       country_of_originTaiwan  
##                                     -0.134839  
## country_of_originTanzania, United Republic Of  
##                                      0.052325  
##       country_of_originUnited States (Hawaii)  
##                                     -0.316031  
##                          varietyBlue Mountain  
##                                     -0.234205  
##                                varietyBourbon  
##                                     -0.004215  
##                                varietyCatimor  
##                                      0.018467  
##                                 varietyCatuai  
##                                      0.015110  
##                                varietyCaturra  
##                                      0.036397  
##                    varietyEthiopian Heirlooms  
##                                     -0.094942  
##                  varietyEthiopian Yirgacheffe  
##                                      0.011110  
##                                  varietyGesha  
##                                      0.046588  
##                          varietyHawaiian Kona  
##                                      0.296594  
##                                   varietyJava  
##                                      0.007740  
##                             varietyMandheling  
##                                      0.001044  
##                             varietyMarigojipe  
##                                     -0.006565  
##                             varietyMundo Novo  
##                                     -0.047911  
##                                  varietyOther  
##                                     -0.019686  
##                               varietyPacamara  
##                                     -0.067598  
##                                  varietyPacas  
##                                     -0.001151  
##                            varietyPache Comun  
##                                     -0.134161  
##                               varietyPeaberry  
##                                     -0.022037  
##                               varietyRuiru 11  
##                                     -0.016437  
##                                   varietySL14  
##                                      0.017365  
##                                   varietySL28  
##                                     -0.256004  
##                                   varietySL34  
##                                     -0.055397  
##                               varietySulawesi  
##                                      0.040376  
##                                varietySumatra  
##                                      0.096590  
##                        varietySumatra Lintong  
##                                      0.080224  
##                                 varietyTypica  
##                                     -0.035801  
##                         varietyYellow Bourbon  
##                                      0.086077  
##                                         aroma  
##                                     -0.003595  
##                                        flavor  
##                                      0.241316  
##                                    aftertaste  
##                                      0.278652  
##                                       acidity  
##                                      0.040398  
##                                          body  
##                                      0.022329  
##                                       balance  
##                                      0.194880  
##                                    uniformity  
##                                     -0.022991  
##                                     clean_cup  
##                                      0.013229  
##                                     sweetness  
##                                     -0.043329  
##                                      moisture  
##                                     -0.505604</code></pre>
<pre class="r"><code>library(ranger)

rf_spec &lt;- rand_forest(mode = &quot;regression&quot;) %&gt;%
  set_engine(&quot;ranger&quot;)

rf_spec</code></pre>
<pre><code>## Random Forest Model Specification (regression)
## 
## Computational engine: ranger</code></pre>
<pre class="r"><code>## Random Forest Model Specification (regression)
##
## Computational engine: ranger
rf_fit &lt;- rf_spec %&gt;%
  fit(cupper_points ~ .,
    data = coffee_train
  )

rf_fit</code></pre>
<pre><code>## parsnip model object
## 
## Fit time:  484ms 
## Ranger result
## 
## Call:
##  ranger::ranger(formula = formula, data = data, num.threads = 1,      verbose = FALSE, seed = sample.int(10^5, 1)) 
## 
## Type:                             Regression 
## Number of trees:                  500 
## Sample size:                      834 
## Number of independent variables:  13 
## Mtry:                             3 
## Target node size:                 5 
## Variable importance mode:         none 
## Splitrule:                        variance 
## OOB prediction error (MSE):       0.04135314 
## R squared (OOB):                  0.7374583</code></pre>
<p>Both models produce a hefty R squared, &gt; .7! This makes me nervous as it’s likely too good to be true (overfit). I know that I skipped some preprocessing steps just to see how these models worked, so let’s go back and see if some <code>recipes</code> can bring my models back down to earth.</p>
</div>
<div id="preprocessing-with-recipes" class="section level1">
<h1>Preprocessing With Recipes</h1>
<ol style="list-style-type: decimal">
<li>Let’s create a bland, vanilla recipe to start off</li>
</ol>
<pre class="r"><code>rec_obj &lt;- recipe(cupper_points ~ ., data = coffee_train) %&gt;% 
  update_role(id, new_role = &quot;ID&quot;) %&gt;% 
  step_normalize(all_predictors(), -all_nominal()) %&gt;% 
  step_dummy(all_nominal())

summary(rec_obj)</code></pre>
<pre><code>## # A tibble: 14 x 4
##    variable          type    role      source  
##    &lt;chr&gt;             &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
##  1 id                numeric ID        original
##  2 country_of_origin nominal predictor original
##  3 variety           nominal predictor original
##  4 aroma             numeric predictor original
##  5 flavor            numeric predictor original
##  6 aftertaste        numeric predictor original
##  7 acidity           numeric predictor original
##  8 body              numeric predictor original
##  9 balance           numeric predictor original
## 10 uniformity        numeric predictor original
## 11 clean_cup         numeric predictor original
## 12 sweetness         numeric predictor original
## 13 moisture          numeric predictor original
## 14 cupper_points     numeric outcome   original</code></pre>
<p>I tell the recipe not to use the “id” column in the analysis and we can see that it is classified as a “ID” and not “predictor”. I run summary on the recipe object and can see the type of role the variables have, as well as the type. It is important to note that ‘nominal’ is yet another term to describe a factor/string/non-numeric.</p>
<p>Then I use the step_* functions to normalize the data (it centers and scales numerical features) and to create dummy variables for all of my nominal (non-numeric) features.</p>
<p>So we built our recipe. Next step is to prep and juice. I’m getting thirsty.</p>
<pre class="r"><code>coff_train &lt;- juice(prep(rec_obj))

dim(coff_train)</code></pre>
<pre><code>## [1] 834  50</code></pre>
<pre class="r"><code>names(coff_train)</code></pre>
<pre><code>##  [1] &quot;id&quot;                                            
##  [2] &quot;aroma&quot;                                         
##  [3] &quot;flavor&quot;                                        
##  [4] &quot;aftertaste&quot;                                    
##  [5] &quot;acidity&quot;                                       
##  [6] &quot;body&quot;                                          
##  [7] &quot;balance&quot;                                       
##  [8] &quot;uniformity&quot;                                    
##  [9] &quot;clean_cup&quot;                                     
## [10] &quot;sweetness&quot;                                     
## [11] &quot;moisture&quot;                                      
## [12] &quot;cupper_points&quot;                                 
## [13] &quot;country_of_origin_Colombia&quot;                    
## [14] &quot;country_of_origin_Costa.Rica&quot;                  
## [15] &quot;country_of_origin_Ethiopia&quot;                    
## [16] &quot;country_of_origin_Guatemala&quot;                   
## [17] &quot;country_of_origin_Honduras&quot;                    
## [18] &quot;country_of_origin_Mexico&quot;                      
## [19] &quot;country_of_origin_Other&quot;                       
## [20] &quot;country_of_origin_Taiwan&quot;                      
## [21] &quot;country_of_origin_Tanzania..United.Republic.Of&quot;
## [22] &quot;country_of_origin_United.States..Hawaii.&quot;      
## [23] &quot;variety_Blue.Mountain&quot;                         
## [24] &quot;variety_Bourbon&quot;                               
## [25] &quot;variety_Catimor&quot;                               
## [26] &quot;variety_Catuai&quot;                                
## [27] &quot;variety_Caturra&quot;                               
## [28] &quot;variety_Ethiopian.Heirlooms&quot;                   
## [29] &quot;variety_Ethiopian.Yirgacheffe&quot;                 
## [30] &quot;variety_Gesha&quot;                                 
## [31] &quot;variety_Hawaiian.Kona&quot;                         
## [32] &quot;variety_Java&quot;                                  
## [33] &quot;variety_Mandheling&quot;                            
## [34] &quot;variety_Marigojipe&quot;                            
## [35] &quot;variety_Moka.Peaberry&quot;                         
## [36] &quot;variety_Mundo.Novo&quot;                            
## [37] &quot;variety_Other&quot;                                 
## [38] &quot;variety_Pacamara&quot;                              
## [39] &quot;variety_Pacas&quot;                                 
## [40] &quot;variety_Pache.Comun&quot;                           
## [41] &quot;variety_Peaberry&quot;                              
## [42] &quot;variety_Ruiru.11&quot;                              
## [43] &quot;variety_SL14&quot;                                  
## [44] &quot;variety_SL28&quot;                                  
## [45] &quot;variety_SL34&quot;                                  
## [46] &quot;variety_Sulawesi&quot;                              
## [47] &quot;variety_Sumatra&quot;                               
## [48] &quot;variety_Sumatra.Lintong&quot;                       
## [49] &quot;variety_Typica&quot;                                
## [50] &quot;variety_Yellow.Bourbon&quot;</code></pre>
<pre class="r"><code>coff_train</code></pre>
<pre><code>## # A tibble: 834 x 50
##       id aroma flavor aftertaste acidity  body balance uniformity clean_cup
##    &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
##  1     2  3.84   3.55       3.27    3.35 3.35     2.68      0.312     0.225
##  2     3  2.77   3.03       3.04    2.84 3.02     2.68      0.312     0.225
##  3     5  2.22   3.03       2.54    3.10 3.35     2.41      0.312     0.225
##  4    10  1.66   3.27       3.27    3.10 0.575    2.68      0.312     0.225
##  5    12  2.22   2.78       2.30    2.56 2.09     1.94      0.312     0.225
##  6    13  1.66   3.55       2.77    2.84 1.80     1.68      0.312     0.225
##  7    16  1.40   3.03       3.51    2.05 2.42     1.44      0.312     0.225
##  8    19  2.77   2.26       2.03    2.05 1.50     1.44      0.312     0.225
##  9    21  1.40   2.26       2.03    3.10 2.72     1.44      0.312     0.225
## 10    23  1.96   2.26       2.30    1.51 1.17     1.94      0.312     0.225
## # … with 824 more rows, and 41 more variables: sweetness &lt;dbl&gt;, moisture &lt;dbl&gt;,
## #   cupper_points &lt;dbl&gt;, country_of_origin_Colombia &lt;dbl&gt;,
## #   country_of_origin_Costa.Rica &lt;dbl&gt;, country_of_origin_Ethiopia &lt;dbl&gt;,
## #   country_of_origin_Guatemala &lt;dbl&gt;, country_of_origin_Honduras &lt;dbl&gt;,
## #   country_of_origin_Mexico &lt;dbl&gt;, country_of_origin_Other &lt;dbl&gt;,
## #   country_of_origin_Taiwan &lt;dbl&gt;,
## #   country_of_origin_Tanzania..United.Republic.Of &lt;dbl&gt;,
## #   country_of_origin_United.States..Hawaii. &lt;dbl&gt;,
## #   variety_Blue.Mountain &lt;dbl&gt;, variety_Bourbon &lt;dbl&gt;, variety_Catimor &lt;dbl&gt;,
## #   variety_Catuai &lt;dbl&gt;, variety_Caturra &lt;dbl&gt;,
## #   variety_Ethiopian.Heirlooms &lt;dbl&gt;, variety_Ethiopian.Yirgacheffe &lt;dbl&gt;,
## #   variety_Gesha &lt;dbl&gt;, variety_Hawaiian.Kona &lt;dbl&gt;, variety_Java &lt;dbl&gt;,
## #   variety_Mandheling &lt;dbl&gt;, variety_Marigojipe &lt;dbl&gt;,
## #   variety_Moka.Peaberry &lt;dbl&gt;, variety_Mundo.Novo &lt;dbl&gt;, variety_Other &lt;dbl&gt;,
## #   variety_Pacamara &lt;dbl&gt;, variety_Pacas &lt;dbl&gt;, variety_Pache.Comun &lt;dbl&gt;,
## #   variety_Peaberry &lt;dbl&gt;, variety_Ruiru.11 &lt;dbl&gt;, variety_SL14 &lt;dbl&gt;,
## #   variety_SL28 &lt;dbl&gt;, variety_SL34 &lt;dbl&gt;, variety_Sulawesi &lt;dbl&gt;,
## #   variety_Sumatra &lt;dbl&gt;, variety_Sumatra.Lintong &lt;dbl&gt;, variety_Typica &lt;dbl&gt;,
## #   variety_Yellow.Bourbon &lt;dbl&gt;</code></pre>
<p>Baking applies the pre-processing steps that were ‘juiced’ above to the test data. This way, the train and test data will have the same pre-processing steps (aka recipe) applied to them. Clever!</p>
<pre class="r"><code>coff_test &lt;- rec_obj %&gt;%
  prep() %&gt;% 
  bake(coffee_test) </code></pre>
<p>So now we see all our predictors including all the dummy variables that were generated. Neat.</p>
</div>
<div id="better-faster-stronger" class="section level1">
<h1>Better, Faster, Stronger</h1>
<p>Now we can go back to the linear and random forest regression models used earlier, but now substitute the data with better processing. I think I see why they went with the “recipe” motif! Like baking, I can swap in ingredients without having to start over from scratch.</p>
<pre class="r"><code>lm_fit1 &lt;- fit(lm_spec, cupper_points ~ ., coff_train)
glance(lm_fit1$fit)</code></pre>
<pre><code>## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC    BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1     0.751         0.736 0.204      49.4 2.55e-203    49   168. -237. -0.335
## # … with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<pre class="r"><code>tidy(lm_fit1) %&gt;% 
  arrange(desc(abs(statistic)))</code></pre>
<pre><code>## # A tibble: 49 x 5
##    term                        estimate std.error statistic  p.value
##    &lt;chr&gt;                          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept)                 7.71     0.109         70.7  0.      
##  2 id                         -0.000309 0.0000479     -6.45 1.99e-10
##  3 aftertaste                  0.0944   0.0163         5.79 1.01e- 8
##  4 balance                     0.0665   0.0132         5.02 6.39e- 7
##  5 flavor                      0.0789   0.0173         4.56 6.07e- 6
##  6 country_of_origin_Taiwan   -0.135    0.0462        -2.92 3.63e- 3
##  7 moisture                   -0.0230   0.00823       -2.79 5.36e- 3
##  8 country_of_origin_Colombia -0.0990   0.0434        -2.28 2.28e- 2
##  9 sweetness                  -0.0177   0.00819       -2.16 3.09e- 2
## 10 variety_SL28               -0.256    0.119         -2.16 3.14e- 2
## # … with 39 more rows</code></pre>
<pre class="r"><code>lm_predicted &lt;- augment(lm_fit1$fit, data = coff_train) 
select(lm_predicted, id, cupper_points, .fitted:.std.resid)</code></pre>
<pre><code>## # A tibble: 834 x 9
##       id cupper_points .fitted .se.fit   .resid   .hat .sigma .cooksd .std.resid
##    &lt;int&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
##  1     2          8.58    8.52  0.0749  0.0562  0.135   0.204 2.80e-4     0.297 
##  2     3          9.25    8.45  0.0431  0.795   0.0447  0.202 1.52e-2     3.99  
##  3     5          8.58    8.39  0.0707  0.187   0.120   0.204 2.67e-3     0.977 
##  4    10          8.5     8.49  0.0721  0.00789 0.125   0.204 5.00e-6     0.0414
##  5    12          8.5     8.34  0.0379  0.162   0.0345  0.204 4.75e-4     0.807 
##  6    13          8.33    8.43  0.0435 -0.0979  0.0456  0.204 2.36e-4    -0.492 
##  7    16          8.17    8.43  0.0443 -0.264   0.0472  0.204 1.78e-3    -1.33  
##  8    19          8.42    8.21  0.0570  0.206   0.0783  0.204 1.92e-3     1.05  
##  9    21          8.17    8.25  0.0407 -0.0779  0.0398  0.204 1.29e-4    -0.390 
## 10    23          8.58    8.24  0.0402  0.344   0.0388  0.204 2.44e-3     1.72  
## # … with 824 more rows</code></pre>
<pre class="r"><code>ggplot(lm_predicted, aes(.fitted, cupper_points)) +
  geom_point(alpha = .2) +
  ggrepel::geom_label_repel(aes(label = id),
                            data = filter(lm_predicted, abs(.resid) &gt; 2)) +
  labs(title = &quot;Linear Model: Actual vs. Predicted Cupper Points&quot;) +
  geom_smooth()</code></pre>
<p><img src="//post/2020-07-07-coffee-ratings_files/figure-html/plot%20lm%20residuals-1.png" width="1440" /></p>
<p>Whoa, what’s up with coffee sample 963? We predicted a score of 7.4 or so, and the real score was a 5.25. This appears just to be a major outlier, so we can likely ignore.</p>
<pre class="r"><code>filter(coffee, id == 963)</code></pre>
<pre><code>## # A tibble: 1 x 14
##      id country_of_orig… variety aroma flavor aftertaste acidity  body balance
##   &lt;int&gt; &lt;fct&gt;            &lt;fct&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1   963 Taiwan           Typica   7.83   7.75       7.67    7.83  7.83    7.75
## # … with 5 more variables: uniformity &lt;dbl&gt;, clean_cup &lt;dbl&gt;, sweetness &lt;dbl&gt;,
## #   cupper_points &lt;dbl&gt;, moisture &lt;dbl&gt;</code></pre>
<p>Now let’s repeat for the random forest model. Note - <code>glance</code> does not work for ranger objects like rf_fit1$fit.</p>
<pre class="r"><code>rf_fit1 &lt;- fit(rf_spec, cupper_points ~ ., coff_train)
rf_fit1$fit</code></pre>
<pre><code>## Ranger result
## 
## Call:
##  ranger::ranger(formula = formula, data = data, num.threads = 1,      verbose = FALSE, seed = sample.int(10^5, 1)) 
## 
## Type:                             Regression 
## Number of trees:                  500 
## Sample size:                      834 
## Number of independent variables:  49 
## Mtry:                             7 
## Target node size:                 5 
## Variable importance mode:         none 
## Splitrule:                        variance 
## OOB prediction error (MSE):       0.04222097 
## R squared (OOB):                  0.7319486</code></pre>
<pre class="r"><code>rf_predicted &lt;- bind_cols(.fitted = rf_fit1$fit$predictions, data = coff_train)
select(rf_predicted, id, cupper_points, .fitted)</code></pre>
<pre><code>## # A tibble: 834 x 3
##       id cupper_points .fitted
##    &lt;int&gt;         &lt;dbl&gt;   &lt;dbl&gt;
##  1     2          8.58    8.60
##  2     3          9.25    8.31
##  3     5          8.58    8.54
##  4    10          8.5     8.41
##  5    12          8.5     8.30
##  6    13          8.33    8.36
##  7    16          8.17    8.33
##  8    19          8.42    8.24
##  9    21          8.17    8.29
## 10    23          8.58    8.14
## # … with 824 more rows</code></pre>
<pre class="r"><code>ggplot(rf_predicted, aes(.fitted, cupper_points)) +
  geom_point(alpha = .2) +
  # ggrepel::geom_label_repel(aes(label = id),
  #                           data = filter(rf_predicted, abs(.resid) &gt; 2)) +
  labs(title = &quot;Random Forest: Actual vs. Predicted Cupper Points&quot;) +
  geom_smooth()</code></pre>
<p><img src="//post/2020-07-07-coffee-ratings_files/figure-html/unnamed-chunk-1-1.png" width="1440" /></p>
<pre class="r"><code>results_train &lt;- lm_fit1 %&gt;%
  predict(new_data = coff_train) %&gt;%
  mutate(
    truth = coff_train$cupper_points,
    model = &quot;lm&quot;
  ) %&gt;% 
bind_rows(rf_fit1 %&gt;%
    predict(new_data = coff_train) %&gt;%
    mutate(
      truth = coff_train$cupper_points,
      model = &quot;rf&quot;
    ))</code></pre>
<pre class="r"><code>results_train %&gt;%
  group_by(model) %&gt;%
  rmse(truth = truth, estimate = .pred)</code></pre>
<pre><code>## # A tibble: 2 x 4
##   model .metric .estimator .estimate
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 lm    rmse    standard       0.198
## 2 rf    rmse    standard       0.114</code></pre>
<p>Apply model to the test set</p>
<pre class="r"><code>lm_fit1 %&gt;%
  predict(coff_test) %&gt;%
  bind_cols(coff_test) %&gt;%
  metrics(truth = cupper_points,
          estimate = .pred) %&gt;%
  bind_cols(model = &quot;lm&quot;) %&gt;% 
  bind_rows(
    rf_fit1 %&gt;%
      predict(coff_test) %&gt;%
      bind_cols(coff_test) %&gt;%
      metrics(truth = cupper_points,
        estimate = .pred
      ) %&gt;% 
  bind_cols(model = &quot;rf&quot;)
  )</code></pre>
<pre><code>## # A tibble: 6 x 4
##   .metric .estimator .estimate model
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;
## 1 rmse    standard       0.244 lm   
## 2 rsq     standard       0.629 lm   
## 3 mae     standard       0.144 lm   
## 4 rmse    standard       0.231 rf   
## 5 rsq     standard       0.664 rf   
## 6 mae     standard       0.130 rf</code></pre>
<p>We see that the random forest and linear model are both very close together in performance. However, the random forest does have a small RMSE and higher R squared, which means it does a slightly better job explaining the variance and has less overall error in predicting the ratings.</p>
</div>
<div id="next-steps" class="section level1">
<h1>Next Steps</h1>
<p>I did all of this analysis without knowing anything about tidymodels. Additionally, I am fairly new to using R for predicting values as well. It would be interesting to see how these models perform with cross-validation, optimized parameters and better feature selection.</p>
<p>The concept of a “recipe” which you can modify and reuse is incredibly interesting in this context. I have a lot more to learn here, and would direct readers to the great YouTube videos made by <a href="https://www.youtube.com/channel/UCTTBgWyJl2HrrhQOOc710kA">Julia Silge</a>.</p>
</div>


    </main>
  </div>
  <footer>
    <div class="footer-wrapper">
      <p>Made with ❤️ &mdash; Powered by <a href="https://gohugo.io/" target="_blank" rel="external">Hugo</a> and the <a href="https://github.com/bjacquemet/personal-web" target='_blank' rel="external">Personal Web</a> theme. Icons come from the great <a href="https://fontawesome.com/license" target="_blank" rel="external">Font Awesome</a> library</p>
      <p>© Joseph Pope</p>
    </div>
  </footer>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:500,600|Raleway:400,400i,600" rel="stylesheet">
  
</body>
</html>
